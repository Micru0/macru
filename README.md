# Macru - Unified CAG App

Macru is a private, secure, modular AI-powered assistant designed to be a central knowledge engine for an individual's work-related data. It addresses the problem of fragmented work information scattered across various documents and platforms, providing a unified, intelligent, and private way to access, query, and interact with your data.

## Overview

Macru leverages Cache-Augmented Generation (CAG) with powerful LLMs (like Gemini 2.5 Pro) and a modular memory layer to deliver high-context, relevant answers and insights based *only* on the user's private data. Its modular architecture allows for easy expansion and integration with various data sources.

## Core Features

*   **Document & Data Ingestion:** Securely ingest data from direct file uploads (PDF, DOCX, TXT) and connected sources like Notion. The system uses a modular `DataConnector` pattern for extensibility.
*   **Cache-Augmented Generation (CAG) Querying:** Ask natural language questions against your ingested data. Macru uses vector search and efficient context assembly to provide relevant answers generated by your chosen LLM.
*   **Modular Memory Layer:** A persistent, personalized, and encrypted memory store (initially using Supabase with RLS) to remember user preferences, key facts, and context, leading to more personalized interactions.
*   **Multi-LLM Architecture:** Supports multiple LLMs (via `llmRouter.ts`), allowing user selection based on preference or need. Currently integrates Google Gemini.
*   **Action Execution Layer (Optional):** Allows the LLM to propose and execute actions on integrated platforms (e.g., create Notion page, schedule Google Calendar event) with mandatory user confirmation by default.
*   **Secure Authentication & Data Storage:** Utilizes Supabase for secure user authentication (Supabase Auth), file storage (Supabase Storage), and database operations (Supabase Postgres with RLS and encryption considerations).

## Tech Stack

*   **Framework:** [Next.js](https://nextjs.org/) (App Router)
*   **Language:** [TypeScript](https://www.typescriptlang.org/)
*   **Database:** [Supabase](https://supabase.io/) (Postgres with pgvector)
*   **Authentication:** Supabase Auth
*   **Storage:** Supabase Storage
*   **Styling:** [Tailwind CSS](https://tailwindcss.com/) with [shadcn/ui](https://ui.shadcn.com/)
*   **LLM Integration:** Google Gemini (via `@google/generative-ai`)
*   **Connectors:** Notion (via `@notionhq/client`)
*   **Memory:** Custom implementation using Supabase

## Getting Started

1.  **Clone the repository:**
    ```bash
    git clone https://github.com/Spa42/macru.git
    cd macru
    ```

2.  **Install dependencies:**
    ```bash
    npm install
    # or yarn install or pnpm install
    ```

3.  **Set up Supabase:**
    *   Create a Supabase project at [supabase.com](https://supabase.com/).
    *   In your Supabase project dashboard:
        *   Enable the `pgvector` extension (Database -> Extensions).
        *   Enable the `pgsodium` extension if you plan to use database-level encryption.
        *   Run the SQL migration scripts located in `scripts/migrations/` and `supabase/migrations/` using the SQL Editor to create the necessary tables (`profiles`, `documents`, `chunks`, `embeddings`, `memory_items`, `connector_tokens`, `action_logs`, etc.) and RLS policies.
        *   Set up Storage buckets (e.g., `documents`, `avatars`).
        *   Configure Authentication settings (e.g., email providers, redirect URLs).

4.  **Configure Environment Variables:**
    *   Create a `.env.local` file in the project root.
    *   Copy the contents of `.env.example` (if available) or add the necessary variables (see below).

5.  **Run the development server:**
    ```bash
    npm run dev
    # or yarn dev or pnpm dev
    ```

6.  Open [http://localhost:3000](http://localhost:3000) with your browser.

## Environment Variables

Create a `.env.local` file in the root directory and add the following essential variables obtained from your Supabase project dashboard and other services:

```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=<YOUR_SUPABASE_PROJECT_URL>
NEXT_PUBLIC_SUPABASE_ANON_KEY=<YOUR_SUPABASE_ANON_KEY>
SUPABASE_SERVICE_ROLE_KEY=<YOUR_SUPABASE_SERVICE_ROLE_KEY>
SUPABASE_JWT_SECRET=<YOUR_SUPABASE_JWT_SECRET>

# LLMs (Example for Google Gemini)
GEMINI_API_KEY=<YOUR_GOOGLE_AI_API_KEY>
# Add keys for other LLMs if configured in llmRouter.ts

# Memory Layer (Optional Toggle)
# ENABLE_MEMORY_LAYER=true

# Notion Connector (If using)
NOTION_CLIENT_ID=<YOUR_NOTION_INTEGRATION_CLIENT_ID>
NOTION_CLIENT_SECRET=<YOUR_NOTION_INTEGRATION_CLIENT_SECRET>
NOTION_REDIRECT_URI=http://localhost:3000/api/connectors/notion/auth/callback

# Internal Sync Trigger (For background sync, e.g., Notion)
INTERNAL_API_SECRET=<A_STRONG_RANDOM_SECRET_SHARED_WITH_SUPABASE_FUNCTIONS>
APP_URL=http://localhost:3000 # Important: Use production URL when deployed

# Add other necessary variables for different connectors or services
```

**Note:** For production deployments, ensure these variables are set in your hosting provider's environment settings, and update `NOTION_REDIRECT_URI` and `APP_URL` accordingly.

## Project Structure

*   `/app`: Next.js App Router pages, layouts, and API routes.
*   `/components`: Reusable UI components (built with shadcn/ui).
*   `/lib`: Core logic, services, utilities, types, context providers.
*   `/public`: Static assets.
*   `/scripts`: Database migration scripts, utility scripts.
*   `/supabase`: Supabase-specific configuration and Edge Functions.
*   `/devlog.txt`: Detailed log of development progress and decisions.

## Development Log

A detailed history of features, fixes, and architectural decisions is maintained in [`devlog.txt`](./devlog.txt).

## Learn More (Next.js)

To learn more about Next.js, take a look at the following resources:

*   [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
*   [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Remember to configure all necessary Environment Variables in your Vercel project settings.

Check out the [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
